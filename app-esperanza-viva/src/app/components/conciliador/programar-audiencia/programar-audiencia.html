<div class="admin-container">
  <aside class="sidebar-viva">
    <div class="logo-section text-center">
      <h5 class="m-0">ESPERANZA VIVA</h5>
      <small>CONCILIACIÓN</small>
    </div>
    <nav class="sidebar-nav">
      <a class="nav-link-viva active" routerLink="/conciliador/mis-casos">
        <i class="bi bi-folder-fill"></i> Mis Casos
      </a>
      <a class="nav-link-viva" routerLink="/conciliador/agenda">
        <i class="bi bi-calendar3"></i> Mi Agenda
      </a>
      <a class="nav-link-viva" routerLink="/conciliador/historial">
        <i class="bi bi-clock-history"></i> Historial
      </a>
    </nav>
    <div class="sidebar-footer">
      <button class="btn-logout-viva w-100" (click)="cerrarSesion()">
        <i class="bi bi-box-arrow-left me-2"></i> Cerrar Sesión
      </button>
    </div>
  </aside>

  <main class="main-content-viva animate-fade-in">
    <header class="d-flex justify-content-between align-items-center mb-5">
      <div>
        <h2 class="viva-page-title">Programación de Audiencia</h2>
        <p class="viva-page-subtitle">Evaluación y Designación</p>
      </div>
      <div class="admin-badge">
        <div class="text-end">
          <div class="user-name">{{ conciliadorNombre }}</div>
          <div class="user-role">Conciliador</div>
        </div>
        <div class="ms-3 bg-warning rounded-circle d-flex align-items-center justify-content-center"
          style="width: 40px; height: 40px;">
          <i class="bi bi-person-fill fs-5 text-dark"></i>
        </div>
      </div>
    </header>

    <h5 class="text-white mb-4 fw-bold text-uppercase ps-1" style="border-left: 4px solid #ffc107; padding-left: 15px;">
      Generar Invitación (Formato C)
    </h5>

    <div class="row g-4 mb-4">
      <div class="col-lg-6">
        <div class="viva-card">
          <span class="card-header-viva">
            <i class="bi bi-calendar-event me-2"></i> Datos de la Audiencia
          </span>
          <div class="row mb-4">
            <div class="col-md-6">
              <label class="viva-label">Fecha de Audiencia</label>
              <input type="date" class="viva-input" [(ngModel)]="form.fechaAudiencia" [disabled]="isYaProgramado">
            </div>
            <div class="col-md-6">
              <label class="viva-label">Hora (10 min tolerancia)</label>
              <input type="time" class="viva-input" [(ngModel)]="form.horaAudiencia" [disabled]="isYaProgramado">
            </div>
          </div>
          <div>
            <label class="viva-label">Lugar de la Audiencia</label>
            <input type="text" class="viva-input" [(ngModel)]="form.lugar" [disabled]="isYaProgramado">
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="viva-card">
          <span class="card-header-viva">
            <i class="bi bi-people-fill me-2"></i> Verificación de Partes
          </span>
          <div class="person-card-container">
            <div class="person-card mb-4" *ngIf="expediente.solicitante">
              <div class="person-info">
                <span class="person-label">SOLICITANTE</span>
                <h4 class="person-name">{{expediente.solicitante.nombres}} {{expediente.solicitante.apellidos}}</h4>
              </div>
            </div>
            <div class="person-card" *ngIf="expediente.invitado">
              <div class="person-info">
                <span class="person-label">INVITADO</span>
                <h4 class="person-name">{{expediente.invitado.nombres}} {{expediente.invitado.apellidos}}</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h5 class="text-white mb-4 fw-bold text-uppercase ps-1 mt-5"
      style="border-left: 4px solid #ffc107; padding-left: 15px;">
      Seleccione un Notificador
    </h5>

    <div class="viva-card mb-5 notificador-card-compact">
      <div class="notificador-trigger" (click)="!isYaProgramado && toggleNotificadores()">
        <div class="d-flex align-items-center justify-content-between w-100">
          <div class="d-flex align-items-center text-white">
            <i class="bi bi-search me-3 text-warning"></i>
            <span *ngIf="selectedNotificador" class="fw-bold me-2 text-warning">{{ selectedNotificador.nombreCompleto
              }}</span>
            <span *ngIf="!selectedNotificador" class="text-secondary">Buscar o seleccionar notificador...</span>
          </div>
          <i class="bi bi-chevron-down text-secondary" [class.rotate-180]="showNotificadoresList"></i>
        </div>
      </div>

      <div class="notificador-dropdown-list" *ngIf="showNotificadoresList">
        <div *ngFor="let notif of notificadores" class="notificador-item-dropdown"
          (click)="seleccionarNotificador(notif)">
          <h6 class="mb-0 text-white">{{ notif.nombreCompleto }}</h6>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <div class="d-flex gap-2">
        <button class="btn-viva btn-pdf" (click)="generarInvitacion()">
          <i class="bi bi-file-pdf-fill fs-5"></i> Descargar PDF
        </button>
        <button class="btn-viva btn-word" (click)="generarWord()"
          style="background-color: #0d6efd; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; transition: all 0.3s ease;">
          <i class="bi bi-file-word-fill fs-5"></i> Descargar Word
        </button>
      </div>

      <button *ngIf="!isYaProgramado" class="btn-viva btn-save ms-auto" (click)="guardarYSalir()"
        [disabled]="!selectedNotificador || isLoading">
        <i class="bi bi-check-circle-fill fs-5"></i> {{ isLoading ? 'Procesando...' : 'Guardar Audiencia' }}
      </button>

      <button *ngIf="isYaProgramado" class="btn btn-success fw-bold px-4 ms-auto" disabled style="opacity: 1;">
        <i class="bi bi-shield-check me-2"></i> AUDIENCIA YA REGISTRADA
      </button>

      <div *ngIf="!selectedNotificador && !isYaProgramado" class="mt-2 text-end w-100">
        <small class="text-danger fw-bold bg-black px-2 py-1 rounded border border-danger">
          <i class="bi bi-exclamation-circle-fill me-1"></i> Notificador Obligatorio
        </small>
      </div>
    </div>
  </main>
</div>