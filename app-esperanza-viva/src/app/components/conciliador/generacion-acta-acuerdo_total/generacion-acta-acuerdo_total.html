<div class="admin-container">
  <aside class="sidebar-viva">
    <div class="logo-section p-4 text-center">
      <h5 class="m-0 fw-bold text-dark">ESPERANZA VIVA</h5>
      <small class="text-dark fw-bold">CENTRO DE CONCILIACIÓN</small>
    </div>
    <nav class="sidebar-nav">
      <a class="nav-link-viva" routerLink="/conciliador/mis-casos"><i class="bi bi-folder-fill"></i> Mis Casos</a>
      <a class="nav-link-viva active" routerLink="/conciliador/agenda"><i class="bi bi-calendar3"></i> Mi Agenda</a>
      <a class="nav-link-viva" routerLink="/conciliador/historial"><i class="bi bi-clock-history"></i> Historial</a>
    </nav>
  </aside>

  <main class="main-content-viva p-4" [class.blur-bg]="mostrarVistaPrevia">
    <header class="d-flex justify-content-between align-items-center mb-4 border-bottom border-warning pb-2">
      <div>
        <h2 class="text-warning fw-bold m-0 text-uppercase">Generación de Acta - Acuerdo Total</h2>
        <p class="text-secondary small">Evaluación de Designación | Expediente: {{expediente.numeroExpediente}}</p>
      </div>
      <div class="admin-badge"><span>{{ conciliadorNombre }} <i class="bi bi-person-circle"></i></span></div>
    </header>

    <div class="row g-4">
      <!-- Sección de Encabezado (Nuevo Requerimiento) -->
      <div class="col-12">
        <section>
          <h6 class="text-white small fw-bold mb-3 text-uppercase">Datos Introductorios del Acta</h6>
          <div class="info-card-wireframe p-4 border-neon d-flex gap-3 flex-wrap align-items-end">
            <div class="flex-grow-1">
              <label class="label-viva">Ciudad</label>
              <input type="text" class="viva-input-black w-100 border-neon-input" [(ngModel)]="acta.ciudad">
            </div>
            <div class="flex-grow-1">
              <label class="label-viva">Distrito</label>
              <input type="text" class="viva-input-black w-100 border-neon-input" [(ngModel)]="acta.distrito">
            </div>
            <div>
              <label class="label-viva">Fecha</label>
              <input type="date" class="viva-input-black border-neon-input" [(ngModel)]="acta.fecha">
            </div>
            <div>
              <label class="label-viva">Hora</label>
              <input type="time" class="viva-input-black border-neon-input" [(ngModel)]="acta.hora">
            </div>
          </div>
        </section>
      </div>

      <div class="col-md-6">
        <section class="mb-4">
          <h6 class="text-white small fw-bold mb-3 text-uppercase">Antecedentes del Conflicto</h6>
          <div class="info-card-wireframe p-3 mb-3 border-neon">
            <label class="label-viva">1. Hechos expuestos en la solicitud</label>
            <textarea class="viva-textarea w-100" rows="4" [(ngModel)]="acta.hechos"
              placeholder="El solicitante indica que el adeudatorio debe..."></textarea>
          </div>
          <div class="info-card-wireframe p-3 border-neon">
            <label class="label-viva">2. Descripcion de las controversias</label>
            <textarea class="viva-textarea w-100" rows="3" [(ngModel)]="acta.controversias"
              placeholder="Determinar la forma de pago..."></textarea>
          </div>
        </section>

        <section>
          <h6 class="text-white small fw-bold mb-3 text-uppercase">Verificación de Legalidad (Requisito Obligatorio)
          </h6>
          <div class="info-card-wireframe p-3 border-neon">
            <label class="label-viva">Seleccione el abogado del centro que visa este acuerdo:</label>
            <select class="viva-input-black w-100" [(ngModel)]="acta.abogadoVerificador">
              <option value="" disabled selected>Abogado verificador</option>
              <option *ngFor="let abogado of abogados" [value]="abogado">{{abogado}}</option>
            </select>
          </div>
        </section>
      </div>

      <div class="col-md-6">
        <section class="h-100">
          <h6 class="text-white small fw-bold mb-3 text-uppercase">Acuerdos Adoptados</h6>
          <div class="info-card-wireframe p-4 h-100 border-neon overflow-auto" style="max-height: 550px;">
            <p class="text-secondary tiny mb-4">Redacte los acuerdos de forma clara, expresa y exigible</p>

            <div *ngFor="let clausula of clausulas; let i = index" class="mb-4">
              <label class="label-viva text-uppercase">{{clausula.titulo}}</label>
              <textarea class="viva-textarea w-100 border-neon-input" rows="2"
                [(ngModel)]="clausula.contenido"></textarea>
            </div>

            <button class="btn btn-warning w-100 fw-bold py-2 mb-3" (click)="agregarClausula()">
              + Agregar Clausula (Tercero, Cuarto...)
            </button>
          </div>
        </section>
      </div>
    </div>

    <div class="d-flex justify-content-end gap-3 mt-5">
      <button class="btn btn-outline-light px-4 fw-bold" (click)="toggleVistaPrevia()">Vista previa formato G</button>

      <!-- New Download Options -->
      <button class="btn btn-outline-warning px-4 fw-bold" (click)="descargarWord()">
        <i class="bi bi-file-word-fill me-2"></i> Descargar Word
      </button>
      <button class="btn btn-outline-danger px-4 fw-bold" (click)="descargarPDF()">
        <i class="bi bi-file-pdf-fill me-2"></i> Descargar PDF
      </button>

      <button class="btn btn-warning px-5 fw-bold shadow text-dark" (click)="emitirActaFinal()">
        Guardar Acta
      </button>
    </div>
  </main>

  <div class="modal-overlay" *ngIf="mostrarVistaPrevia">
    <div class="acta-preview animate__animated animate__zoomIn">
      <div class="d-flex justify-content-end p-2"><button class="btn-close" (click)="toggleVistaPrevia()"></button>
      </div>
      <div class="p-5 text-dark acta-content">
        <div class="text-center mb-5">
          <h6 class="fw-bold">ACTA DE CONCILIACIÓN N° XXX-2026</h6>
          <p class="small">ACUERDO TOTAL</p>
        </div>
        <p>En el Centro de Conciliación <b>ESPERANZA VIVA</b>...</p>
        <div *ngFor="let c of clausulas" class="mb-2">
          <b>{{c.titulo}}:</b> {{c.contenido}}
        </div>
      </div>
    </div>
  </div>
</div>