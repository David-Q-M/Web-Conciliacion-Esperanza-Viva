<div class="admin-container">
  <aside class="sidebar-viva">
    <div class="logo-section">
      <h5 class="m-0 fw-bold text-black" style="color: #000 !important;">ESPERANZA VIVA</h5>
      <small class="text-black fw-bold" style="color: #000 !important;">ADMINISTRACIÓN</small>
    </div>
    <nav class="sidebar-nav">
      <a class="nav-link-viva" routerLink="/admin-dashboard" routerLinkActive="active">
        <i class="bi bi-speedometer2 me-2"></i> Inicio
      </a>
      <a class="nav-link-viva" routerLink="/gestion-usuarios" routerLinkActive="active">
        <i class="bi bi-people-fill me-2"></i> Gestión de usuarios
      </a>
      <a class="nav-link-viva" routerLink="/configuracion" routerLinkActive="active">
        <i class="bi bi-sliders me-2"></i> Configuración
      </a>
      <a class="nav-link-viva active" routerLink="/auditoria" routerLinkActive="active">
        <i class="bi bi-shield-lock-fill me-2"></i> Auditoría
      </a>
      <a class="nav-link-viva" routerLink="/reportes" routerLinkActive="active">
        <i class="bi bi-bar-chart-fill me-2"></i> Reportes
      </a>
    </nav>
    <div class="sidebar-footer px-3">
      <button class="btn w-100 fw-bold" style="background: #000; color: #fff;" (click)="cerrarSesion()">
        <i class="bi bi-box-arrow-left"></i> Cerrar Sesión
      </button>
    </div>
  </aside>

  <main class="main-content-viva">
    <header class="d-flex justify-content-between align-items-center mb-5">
      <div class="header-titles">
        <h2 class="text-warning fw-bold m-0">Auditoría del Sistema</h2>
        <p class="text-secondary small m-0">Rastreo completo de acciones y seguridad</p>
      </div>
      <div class="admin-badge text-end">
        <div class="text-white fw-bold">{{ usuarioActivo }}</div>
        <small class="text-success">● En línea</small>
      </div>
    </header>

    <!-- Filtros y Acciones -->
    <div class="glass-card mb-4 p-3 d-flex align-items-center gap-3 flex-wrap">
      <div class="d-flex align-items-center gap-2 flex-grow-1">
        <i class="bi bi-search text-secondary"></i>
        <input type="text" [(ngModel)]="filtroUsuario" (input)="filtrarLogs()"
          class="form-control form-control-sm bg-dark text-white border-secondary" placeholder="Buscar por usuario...">
      </div>
      <div class="d-flex align-items-center gap-2">
        <label class="text-secondary small">Fecha:</label>
        <input type="date" [(ngModel)]="filtroFecha" (change)="filtrarLogs()"
          class="form-control form-control-sm bg-dark text-white border-secondary">
      </div>
      <button class="btn btn-outline-success btn-sm" (click)="exportarCSV()">
        <i class="bi bi-file-earmark-spreadsheet-fill"></i> Exportar CSV
      </button>
    </div>

    <div class="glass-card p-0">
      <div class="table-responsive">
        <table class="table table-dark table-hover m-0 align-middle">
          <thead>
            <tr class="text-secondary small text-uppercase">
              <th class="ps-4">Fecha/Hora</th>
              <th>Usuario</th>
              <th>Acción</th>
              <th>Detalles</th>
              <th class="text-center pe-4">ID Exp</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of logs">
              <td class="ps-4 text-nowrap">
                <span class="text-white fw-bold">{{ log.fechaHora | date:'dd/MM/yyyy' }}</span>
                <br>
                <small class="text-secondary">{{ log.fechaHora | date:'HH:mm:ss' }}</small>
              </td>
              <td>
                <div class="fw-bold">{{ log.usuarioNombre }}</div>
                <small class="text-secondary" style="font-size: 0.75rem;">Usuario del Sistema</small>
              </td>
              <td>
                <span class="badge" [ngClass]="{
                    'bg-primary': log.accion === 'LOGIN',
                    'bg-warning text-dark': log.accion === 'ACTUALIZACION' || log.accion === 'ACTUALIZACIÓN',
                    'bg-success': log.accion === 'REGISTRO',
                    'bg-danger': log.accion === 'ELIMINACION',
                    'bg-indigo': log.accion === 'ASIGNACION' || log.accion === 'ASIGNACIÓN',
                    'bg-purple': log.accion === 'PROGRAMACION' || log.accion === 'PROGRAMACIÓN',
                    'bg-teal': log.accion === 'RESULTADO'
                  }">
                  {{ log.accion }}
                </span>
              </td>
              <td class="text-secondary small">{{ log.detalles }}</td>
              <td class="text-center pe-4 font-monospace text-info">{{ log.expedienteId || '-' }}</td>
            </tr>
            <tr *ngIf="logs.length === 0">
              <td colspan="5" class="text-center py-5 text-secondary">
                <div class="d-flex flex-column align-items-center opacity-50">
                  <i class="bi bi-search fs-1 mb-3"></i>
                  <p class="m-0">No se encontraron registros coincidentes.</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>
